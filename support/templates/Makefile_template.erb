# @file Makefile for <%= execute_file_name %>
# @author <%= author %>
OBJNAME = <%= execute_file_name %>
<% if option!="" then %>
OPT = <%= option %>
<% else %><% end %>
# includeするファイルへのパス
INC =
# linkするライブラリへのパス
LIBS =
LIBS_OPT =
LIBS_DEBUG =

# コンパイラの設定
CC = g++
CFLAGS = -Wall
CFLAGS_D = -Wall

# skl用の設定
PATH_TO_SKL_ROOT = <%= RelativePathToRoot %>
BINDIR = ${PATH_TO_SKL_ROOT}/bin/
ADDITIONAL_SKL_MODULE = <%= sklModule %>
ADDITIONAL_SKL_MODULEs = <%= sklmodule %>
SKL_LIBDIR = ${PATH_TO_SKL_ROOT}/lib
SKL_INCDIR += ${ADDITIONAL_SKL_MODULE:%=${PATH_TO_SKL_ROOT}modules/%/include/}
INC += ${SKL_INCDIR:%=-I %}
LIBS += -L${SKL_LIBDIR} ${ADDITIONAL_SKL_MODULEs:%=-lskltest_%}
LIBS_DEBUG += -L${SKL_LIBDIR} ${ADDITIONAL_SKL_MODULEs:%=-lskltest_%_d}

# public modules
PATH_TO_PUBLIC_SKL = ${PATH_TO_SKL_ROOT}/public_modules
INC += -I ${PATH_TO_PUBLIC_SKL}/include
PUBLIC_LIBDIR = ${PATH_TO_PUBLIC_SKL}/lib
PUBLIC_SKL_MODULEs = <%= sklpublicmodule %>
LIBS += -L${PUBLIC_LIBDIR} ${PUBLIC_SKL_MODULEs:%=-lskl_%}
# 公開されたモジュールではreleaseとしてコンパイルされたライブラリを使う
LIBS_DEBUG += -L${PUBLIC_LIBDIR} ${PUBLIC_SKL_MODULEs:%=-lskl_%}

<%= otheroptions %>

.SUFFIXES:.cpp

.PHONY:clean debug

default:${OBJNAME}
debug:${OBJNAME}_d

${OBJNAME}:${OBJNAME}.o  ${OPT:%=%.o}
	$(CC) ${CFLAGS} -o $@ $@.o ${OPT:%=%.o} $(INC) $(LIBS) $(LIBS_OPT) -O2 -D__linux__
	cp $@ $(BINDIR)$@

.cpp.o:
	$(CC) -c ${CFLAGS} -o $@ $? $(INC)

${OBJNAME}_d:${OBJNAME}_d.o  ${OPT:%=%_d.o}
	$(CC) ${CFLAGS} -o $@ $@.o ${OPT:%=%_d.o} $(INC) $(LIBS_DEBUG) $(LIBS_OPT) -DDEBUG

%_d.o:%.cpp
	$(CC) -g -c $(CFLAGS_D) -o $@ $? $(INC) -DDEBUG -D__linux_

clean:
	rm -rf $(OBJNAME).o $(OBJNAME)_d.o ${OPT:%=%.o} ${OPT:%=%_d.o} $(OBJNAME) $(OBJNAME)_d
	rm -rf $(BINDIR)$(OBJNAME)
